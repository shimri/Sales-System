### Sales API - Authentication and Order Endpoints
### Base URL: http://localhost:3000
###
### AUTHENTICATION FLOW:
### 1. Register a new user with POST /auth/register
### 2. Login with POST /auth/login to get an access_token (JWT)
### 3. Use the access_token in the Authorization header for protected endpoints
###
### Note: Product availability is now checked before order confirmation.
### Available products in mock inventory:
###   - product-1: 100 units
###   - product-2: 50 units
###   - product-3: 200 units
###   - product-4: 75 units
###   - product-5: 30 units
###
### SECURITY: All protected endpoints require JWT authentication via Authorization header.
### Format: Authorization: Bearer <access_token>
### The JWT token contains a 'userId' claim that must match the userId in the request body.
### Example token payload: { "userId": "<uuid>", "email": "user@example.com" }

### ============================================
### AUTHENTICATION ENDPOINTS
### ============================================

### Register a new user
POST http://localhost:3000/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}

### Login and get JWT token
### Save the access_token from the response for use in subsequent requests
POST http://localhost:3000/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}

### ============================================
### ORDER ENDPOINTS (Require Authentication)
### ============================================
### Note: Replace <access_token> with the token received from /auth/login
### The userId in the request body must match the userId in the JWT token

### Create Order - Basic Request (Success)
### This should succeed as product-1 has 100 units available
### Note: Replace <access_token> with token from /auth/login
### Replace <user-id> with the userId from the login response
POST http://localhost:3000/orders
Content-Type: application/json
Authorization: Bearer <access_token>

{
  "userId": "<user-id>",
  "idempotencyKey": "unique-key-123456",
  "items": [
    {
      "productId": "product-1",
      "quantity": 2,
      "price": 29.99,
      "name": "Sample Product"
    }
  ],
  "amount": 59.98
}

### Create Order - With Multiple Items (Success)
### This should succeed as all products are available
### Note: Replace <access_token> and <user-id> with values from login
POST http://localhost:3000/orders
Content-Type: application/json
Authorization: Bearer <access_token>

{
  "userId": "<user-id>",
  "idempotencyKey": "unique-key-789012",
  "items": [
    {
      "productId": "product-1",
      "quantity": 10,
      "price": 29.99,
      "name": "Product 1"
    },
    {
      "productId": "product-2",
      "quantity": 5,
      "price": 15.50,
      "name": "Product 2"
    },
    {
      "productId": "product-3",
      "quantity": 20,
      "price": 9.99,
      "name": "Product 3"
    }
  ],
  "amount": 524.40
}

### Create Order - Minimal Request (Success)
### This should succeed as product-3 has 200 units available
### Note: Replace <access_token> and <user-id> with values from login
POST http://localhost:3000/orders
Content-Type: application/json
Authorization: Bearer <access_token>

{
  "userId": "<user-id>",
  "idempotencyKey": "unique-key-345678",
  "items": [
    {
      "productId": "product-3",
      "quantity": 1,
      "price": 10.00
    }
  ],
  "amount": 10.00
}

### Create Order - Product Unavailable (Failure)
### This should fail with 400 Bad Request - product-2 only has 50 units, requesting 100
### Note: Replace <access_token> and <user-id> with values from login
POST http://localhost:3000/orders
Content-Type: application/json
Authorization: Bearer <access_token>

{
  "userId": "<user-id>",
  "idempotencyKey": "unique-key-999999",
  "items": [
    {
      "productId": "product-2",
      "quantity": 100,
      "price": 15.50,
      "name": "Product 2"
    }
  ],
  "amount": 1550.00
}

### Create Order - Multiple Products, One Unavailable (Failure)
### This should fail - product-5 only has 30 units, requesting 50
### Note: Replace <access_token> and <user-id> with values from login
POST http://localhost:3000/orders
Content-Type: application/json
Authorization: Bearer <access_token>

{
  "userId": "<user-id>",
  "idempotencyKey": "unique-key-888888",
  "items": [
    {
      "productId": "product-1",
      "quantity": 10,
      "price": 29.99,
      "name": "Product 1"
    },
    {
      "productId": "product-5",
      "quantity": 50,
      "price": 19.99,
      "name": "Product 5"
    }
  ],
  "amount": 1298.90
}

### Create Order - Non-existent Product (Failure)
### This should fail - product-999 doesn't exist in inventory
### Note: Replace <access_token> and <user-id> with values from login
POST http://localhost:3000/orders
Content-Type: application/json
Authorization: Bearer <access_token>

{
  "userId": "<user-id>",
  "idempotencyKey": "unique-key-777777",
  "items": [
    {
      "productId": "product-999",
      "quantity": 1,
      "price": 10.00,
      "name": "Non-existent Product"
    }
  ],
  "amount": 10.00
}

